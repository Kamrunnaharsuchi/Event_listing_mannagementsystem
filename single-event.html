<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Event Listing Management</title>
    <!-- bootstrap cdn -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lightgallery.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-zoom.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/css/lg-thumbnail.min.css"
    />
    <!-- custom css -->
    <link
      rel="stylesheet"
      href="dist/css/style.css"
    />

    <!-- script cdn -->
    <!-- Bootstrap js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery cdn -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- isotope js -->
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.js"></script>
    <!-- imagesLoaded js -->
    <script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
    <!-- Lightgallery JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/lightgallery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/zoom/lg-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script>
  </head>
  <body>
    <header>
      <nav class="navbar navbar-expand-lg">
        <div class="container">
          <a
            class="navbar-brand"
            href="index.html"
          >
            <img
              src="dist/images/logo.png"
              alt="Logo Image"
              width="250px"
            />
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div
            class="collapse navbar-collapse justify-content-end"
            id="navbarSupportedContent"
          >
            <div class="d-flex align-items-center justify-content-between w-75">
              <ul class="navbar-nav mb-2 gap-4 mb-lg-0">
                <li class="nav-item">
                  <a
                    class="nav-link"
                    aria-current="page"
                    href="index.html"
                    >Home</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="about.html"
                    >About</a
                  >
                </li>
                <li class="nav-item position-relative">
                  <a
                    class="nav-link dropdown_has"
                    href="#"
                    >Category</a
                  >
                  <div class="dropdown_menu position-absolute">
                    <ul></ul>
                  </div>
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link active"
                    href="events.html"
                    >Events</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="gallery.html"
                    >Gallery</a
                  >
                </li>
              </ul>
              <form id="searchForm">
                <div class="input-wrapper">
                  <button class="icon">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      height="20px"
                      width="20px"
                    >
                      <path
                        stroke-linejoin="round"
                        stroke-linecap="round"
                        stroke-width="1.5"
                        stroke="#fff"
                        d="M11.5 21C16.7467 21 21 16.7467 21 11.5C21 6.25329 16.7467 2 11.5 2C6.25329 2 2 6.25329 2 11.5C2 16.7467 6.25329 21 11.5 21Z"
                      ></path>
                      <path
                        stroke-linejoin="round"
                        stroke-linecap="round"
                        stroke-width="1.5"
                        stroke="#fff"
                        d="M22 22L20 20"
                      ></path>
                    </svg>
                  </button>
                  <input
                    placeholder="Search.."
                    class="input"
                    name="text"
                    id="searchInput"
                    type="text"
                  />
                </div>
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>
    <section class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-lg-8">
            <div class="single_post_wrapper">
              <h1 id="eventTitle">Loading Event...</h1>
              <div id="eventMeta"></div>
              <div
                id="eventDescription"
                class="mt-4"
              ></div>
              <div
                id="eventImage"
                class="mt-4 mb-4"
              ></div>
            </div>
            <div class="relative_event">
              <h3>Related Events</h3>
              <hr />
              <div
                class="row"
                id="relatedEvents"
              ></div>
            </div>
          </div>
          <div class="col-lg-4 ps-5">
            <div class="sidebar_wrapper">
              <div class="sidebarlastest_event_wrapper">
                <h4>Latest Events</h4>
                <hr />
                <div
                  class="card_wrapper_sidebar"
                  id="latestEvents"
                >
                </div>
              </div>
              <div class="sidebar_cat_wrapper">
                <h4>Categories</h4>
                <hr />
                <ul
                  class="list-unstyled"
                  id="categoriesList"
                >
                </ul>
              </div>
              <div class="sidebarupcoming_event_wrapper mt-4">
                <h4>Up Coming Events</h4>
                <hr />
                <div
                  class="card_wrapper_sidebar"
                  id="upcomingEvents"
                >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <footer class="pt-5">
      <div class="container">
        <div class="row">
          <div class="col-lg-5">
            <div class="footer-logo mb-4">
              <img
                width="250px"
                src="dist/images/footer_logo.png"
                alt="Footer Logo"
              />
            </div>
            <p>
              This is a dynamic University Event Listing System.<br />
              Showcases upcoming events and campus activities.<br />
              Built with HTML, CSS, JavaScript, and Node.js.<br />
              Event data is managed using a JSON file backend.<br />
              Developed by Team Flairia with a focus on simplicity and
              usability.
            </p>
          </div>
          <div class="col-lg-4">
            <h4 class="mb-3">Quick Links</h4>
            <div class="row">
              <div class="col-lg-6">
                <ul class="list-unstyled">
                  <li><a href="index.html">Home</a></li>
                  <li><a href="about.html">About Us</a></li>
                  <li><a href="events.html">Events</a></li>
                </ul>
              </div>
              <div class="col-lg-6">
                <ul class="list-unstyled">
                  <li><a href="gallery.html">Gallery</a></li>
                  <li><a href="#">Privacy Policy</a></li>
                  <li><a href="./admin/index.html">Admin Panel</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-lg-3">
            <h4 class="mb-3">Contact Us</h4>
            <ul class="list-unstyled">
              <li>
                <i class="fa-solid fa-location-dot"></i> 40, Kemal Ataturk Ave, Banani, Dhaka-1213
              </li>
              <li><i class="fa-solid fa-phone"></i> +88 01844 075 476</li>
              <li><i class="fa-solid fa-envelope"></i> contact@ius.com</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="text-center bg-dark py-3 mt-5">
        <p class="mb-0">Â© 2025 Developed by Flairia. All rights reserved.</p>
      </div>
    </footer>
    <script src="dist/js/app.js"></script>
     <script type="text/javascript">
      const urlParams = new URLSearchParams(window.location.search);
      const eventId = urlParams.get("id");
      
      if (!eventId) {
        window.location.href = "index.html";
      }
      
      window.addEventListener("scroll", () => {
        const header = document.querySelector("header");
        if (window.scrollY > 0) {
          header.classList.add("scrolled");
        } else {
          header.classList.remove("scrolled");
        }
      });
      
      // Function to format date
      function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('en-US', options);
      }
      
      // Load main event data
      function loadEventData() {
        fetch(`${BACKEND_API_URL}/events/${eventId}`)
          .then(response => {
            if (!response.ok) {
              throw new Error('Event not found');
            }
            return response.json();
          })
          .then(response => {
            if (!response.success) {
              throw new Error('API returned error');
            }
            
            const data = response.data;
            const eventData = data.main;
            
            // Update page title
            document.title = `${eventData.title} | Event Listing Management`;
            
            // Populate event details
            document.getElementById('eventTitle').textContent = eventData.title;
            
            // Populate event meta information
            const eventMeta = document.getElementById('eventMeta');
            eventMeta.innerHTML = `
              <p>
                <a href="category.html?id=${eventData.category}" class="text-decoration-none cat_wrapper">${eventData.category_name}</a>
                <a href="#" class="text-decoration-none cat_wrapper">Date: ${formatDate(eventData.date)}</a>
                ${eventData.type ? `<span class="cat_wrapper">Type: ${eventData.type}</span>` : ''}
              </p>
            `;
            
            const eventDescription = document.getElementById('eventDescription');
            eventDescription.innerHTML = eventData.description || 'No description available.';
            
            if (!eventData.description.includes('<img')) {
              const eventImage = document.getElementById('eventImage');
              eventImage.innerHTML = `
                <img src="${eventData.thumbnail || 'dist/images/event.jpg'}" alt="${eventData.title}" class="img-fluid rounded">
              `;
            }
            
            // Display related events
            displayRelatedEvents(data.relatedEvents);
            
            // Display most recent events
            displayMostRecentEvents(data.mostRecentEvents);
            
            // Display upcoming events
            displayUpcomingEvents(data.upcomingEvents);
          })
          .catch(error => {
            console.error('Error fetching event:', error);
            document.getElementById('eventTitle').textContent = 'Event Not Found';
            document.getElementById('eventDescription').innerHTML = '<p>Sorry, the requested event could not be found. Please check the URL or return to the <a href="events.html">events page</a>.</p>';
          });
      }
      
      // Display related events from API response
      function displayRelatedEvents(relatedEvents) {
        const relatedEventsContainer = document.getElementById('relatedEvents');
        
        if (!relatedEvents || relatedEvents.length === 0) {
          relatedEventsContainer.innerHTML = '<p class="col-12">No related events found.</p>';
          return;
        }
        
        // Create HTML for related events
        relatedEventsContainer.innerHTML = relatedEvents.map(event => `
          <div class="col-lg-4 mb-4">
            <div class="card_wrapper position-relative">
              <div class="category_type_text position-absolute top-0 start-0 bg-white px-3 py-1">
                ${event.type || event.category_name}
              </div>
              <div class="img_wrapper overflow-hidden">
                <a href="single-event.html?id=${event.id}">
                  <img src="${event.thumbnail || 'dist/images/event.jpg'}" alt="${event.title}" style="height: 200px; width: 100%; object-fit: cover;">
                </a>
              </div>
              <div class="card_desc p-2">
                <h4>
                  <a href="single-event.html?id=${event.id}" class="text-decoration-none">
                    ${event.title.substring(0, 22) + '...'}
                  </a>
                </h4>
                <p class="mb-0">Date: ${formatDate(event.date)}</p>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      // Display most recent events in sidebar
      function displayMostRecentEvents(recentEvents) {
        const latestEventsContainer = document.getElementById('latestEvents');
        
        if (!recentEvents || recentEvents.length === 0) {
          latestEventsContainer.innerHTML = '<p>No recent events found.</p>';
          return;
        }
        
        // Get first 3 events
        const eventsToShow = recentEvents.slice(0, 4);
        
        latestEventsContainer.innerHTML = eventsToShow.map(event => `
          <div class="second_event_cat_wrapper mb-4">
            <img src="${event.thumbnail || 'dist/images/event.jpg'}" alt="${event.title}" style="width: 80px; height: 80px; object-fit: cover;">
            <div>
              <div class="cat_wapper_event">
                <a href="category.html?id=${event.category}" class="text-decoration-none">${event.category_name}</a>
              </div>
              <div class="event_title_wrapper_cat">
                <h4>
                  <a href="single-event.html?id=${event.id}">
                    ${event.title.length > 24 ? event.title.substring(0, 24) + '...' : event.title}
                  </a>
                </h4>
              </div>
              <div class="event_date_wrapper_cat">
                <p>Date: ${formatDate(event.date)}</p>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      // Display upcoming events in sidebar
      function displayUpcomingEvents(upcomingEvents) {
        const upcomingEventsContainer = document.getElementById('upcomingEvents');
        
        if (!upcomingEvents || upcomingEvents.length === 0) {
          upcomingEventsContainer.innerHTML = '<p>No upcoming events found.</p>';
          return;
        }
        
        upcomingEventsContainer.innerHTML = upcomingEvents.map(event => `
          <div class="second_event_cat_wrapper mb-4">
            <img src="${event.thumbnail || 'dist/images/event.jpg'}" alt="${event.title}" style="width: 80px; height: 80px; object-fit: cover;">
            <div>
              <div class="cat_wapper_event">
                <a href="category.html?id=${event.category}" class="text-decoration-none">${event.category_name}</a>
              </div>
              <div class="event_title_wrapper_cat">
                <h4>
                  <a href="single-event.html?id=${event.id}">
                    ${event.title.length > 24 ? event.title.substring(0, 24) + '...' : event.title}
                  </a>
                </h4>
              </div>
              <div class="event_date_wrapper_cat">
                <p>Date: ${formatDate(event.date)}</p>
              </div>
            </div>
          </div>
        `).join('');
      }
      
      // Initialize everything when the DOM is loaded
      document.addEventListener('DOMContentLoaded', () => {
        loadEventData(); // This will also load related, recent and upcoming events
      });
    </script>
  </body>
</html>
